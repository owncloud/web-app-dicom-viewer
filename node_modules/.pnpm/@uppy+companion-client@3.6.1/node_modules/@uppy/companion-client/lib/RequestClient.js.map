{"version":3,"names":["_Symbol$for","_classPrivateFieldLooseBase","receiver","privateKey","Object","prototype","hasOwnProperty","call","TypeError","id","_classPrivateFieldLooseKey","name","pRetry","AbortError","fetchWithNetworkError","ErrorWithCause","emitSocketProgress","getSocketHost","AuthError","packageJson","stripSlash","url","replace","retryCount","socketActivityTimeoutMs","authErrorStatusCode","HttpError","Error","constructor","_ref","statusCode","message","handleJSONResponse","res","status","ok","json","errMsg","statusText","errData","requestId","allowedHeadersCache","Map","_companionHeaders","_getUrl","_requestSocketToken","_awaitRemoteFileUpload","Symbol","for","RequestClient","uppy","opts","defineProperty","value","_awaitRemoteFileUpload2","_getUrl2","writable","_ref2","file","postBody","signal","remote","post","body","token","onReceiveResponse","bind","companionHeaders","setCompanionHeaders","headers","hostname","companion","getState","host","companionUrl","defaultHeaders","Accept","VERSION","_ref3","state","has","get","setState","preflight","path","allowedHeadersCached","fallbackAllowedHeaders","promise","response","fetch","method","header","set","log","allowedHeaders","split","map","headerName","trim","toLowerCase","err","delete","preflightAndHeaders","Promise","all","fromEntries","entries","filter","_ref4","includes","request","_ref5","data","skipPostResponse","credentials","companionCookiesRule","JSON","stringify","cause","options","undefined","uploadRemoteFile","reqBody","_this","getQueue","_this$uppy$getFile","existingServerToken","getFile","serverToken","queue","queueRequestSocketToken","wrapPromiseFunction","arguments","outerErr","isRetryableHttpError","priority","abortOn","setFileState","retries","onFailedAttempt","emit","test","_ref6","removeEventHandlers","capabilities","resolve","reject","socket","socketAbortController","activityTimeout","isPaused","socketSend","action","payload","readyState","OPEN","_socket","String","send","sendState","resumableUploads","createWebsocket","abort","AbortController","onFatalError","_socketAbortControlle","resetActivityTimeout","clearTimeout","setTimeout","reconnectWebsocket","resolveSocket","rejectSocket","WebSocket","addEventListener","error","close","e","parse","_socketAbortControlle2","uploadURL","assign","closeSocket","aborted","pause","newPausedState","_socketAbortControlle3","onFileRemove","targetFile","_socketAbortControlle4","individualCancellation","onCancelAll","_ref7","_socketAbortControlle5","reason","onFilePausedChange","targetFileId","onPauseAll","onResumeAll","on","off","_socketAbortControlle6","version"],"sources":["RequestClient.js"],"sourcesContent":["'use strict'\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport pRetry, { AbortError } from 'p-retry'\n\nimport fetchWithNetworkError from '@uppy/utils/lib/fetchWithNetworkError'\nimport ErrorWithCause from '@uppy/utils/lib/ErrorWithCause'\nimport emitSocketProgress from '@uppy/utils/lib/emitSocketProgress'\nimport getSocketHost from '@uppy/utils/lib/getSocketHost'\n\nimport AuthError from './AuthError.js'\n\nimport packageJson from '../package.json'\n\n// Remove the trailing slash so we can always safely append /xyz.\nfunction stripSlash (url) {\n  return url.replace(/\\/$/, '')\n}\n\nconst retryCount = 10 // set to a low number, like 2 to test manual user retries\nconst socketActivityTimeoutMs = 5 * 60 * 1000 // set to a low number like 10000 to test this\n\nconst authErrorStatusCode = 401\n\nclass HttpError extends Error {\n  statusCode\n\n  constructor({ statusCode, message }) {\n    super(message)\n    this.statusCode = statusCode\n  }\n}\n\nasync function handleJSONResponse (res) {\n  if (res.status === authErrorStatusCode) {\n    throw new AuthError()\n  }\n\n  if (res.ok) {\n    return res.json()\n  }\n\n  let errMsg = `Failed request with status: ${res.status}. ${res.statusText}`\n  try {\n    const errData = await res.json()\n\n    errMsg = errData.message ? `${errMsg} message: ${errData.message}` : errMsg\n    errMsg = errData.requestId\n      ? `${errMsg} request-Id: ${errData.requestId}`\n      : errMsg\n  } catch {\n    /* if the response contains invalid JSON, let's ignore the error */\n  }\n\n  throw new HttpError({ statusCode: res.status, message: errMsg })\n}\n\n// todo pull out into core instead?\nconst allowedHeadersCache = new Map()\n\nexport default class RequestClient {\n  static VERSION = packageJson.version\n\n  #companionHeaders\n\n  constructor (uppy, opts) {\n    this.uppy = uppy\n    this.opts = opts\n    this.onReceiveResponse = this.onReceiveResponse.bind(this)\n    this.#companionHeaders = opts?.companionHeaders\n  }\n\n  setCompanionHeaders (headers) {\n    this.#companionHeaders = headers\n  }\n\n  [Symbol.for('uppy test: getCompanionHeaders')] () {\n    return this.#companionHeaders\n  }\n\n  get hostname () {\n    const { companion } = this.uppy.getState()\n    const host = this.opts.companionUrl\n    return stripSlash(companion && companion[host] ? companion[host] : host)\n  }\n\n  async headers () {\n    const defaultHeaders = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      'Uppy-Versions': `@uppy/companion-client=${RequestClient.VERSION}`,\n    }\n\n    return {\n      ...defaultHeaders,\n      ...this.#companionHeaders,\n    }\n  }\n\n  onReceiveResponse ({ headers }) {\n    const state = this.uppy.getState()\n    const companion = state.companion || {}\n    const host = this.opts.companionUrl\n\n    // Store the self-identified domain name for the Companion instance we just hit.\n    if (headers.has('i-am') && headers.get('i-am') !== companion[host]) {\n      this.uppy.setState({\n        companion: { ...companion, [host]: headers.get('i-am') },\n      })\n    }\n  }\n\n  #getUrl (url) {\n    if (/^(https?:|)\\/\\//.test(url)) {\n      return url\n    }\n    return `${this.hostname}/${url}`\n  }\n\n  /*\n    Preflight was added to avoid breaking change between older Companion-client versions and\n    newer Companion versions and vice-versa. Usually the break will manifest via CORS errors because a\n    version of companion-client could be sending certain headers to a version of Companion server that\n    does not support those headers. In which case, the default preflight would lead to CORS.\n    So to avoid those errors, we do preflight ourselves, to see what headers the Companion server\n    we are communicating with allows. And based on that, companion-client knows what headers to\n    send and what headers to not send.\n\n    The preflight only happens once throughout the life-cycle of a certain\n    Companion-client <-> Companion-server pair (allowedHeadersCache).\n    Subsequent requests use the cached result of the preflight.\n    However if there is an error retrieving the allowed headers, we will try again next time\n  */\n  async preflight (path) {\n    const allowedHeadersCached = allowedHeadersCache.get(this.hostname)\n    if (allowedHeadersCached != null) return allowedHeadersCached\n\n    const fallbackAllowedHeaders = [\n      'accept',\n      'content-type',\n      'uppy-auth-token',\n    ]\n\n    const promise = (async () => {\n      try {\n        const response = await fetch(this.#getUrl(path), { method: 'OPTIONS' })\n\n        const header = response.headers.get('access-control-allow-headers')\n        if (header == null || header === '*') {\n          allowedHeadersCache.set(this.hostname, fallbackAllowedHeaders)\n          return fallbackAllowedHeaders\n        }\n\n        this.uppy.log(\n          `[CompanionClient] adding allowed preflight headers to companion cache: ${this.hostname} ${header}`,\n        )\n\n        const allowedHeaders = header\n          .split(',')\n          .map((headerName) => headerName.trim().toLowerCase())\n        allowedHeadersCache.set(this.hostname, allowedHeaders)\n        return allowedHeaders\n      } catch (err) {\n        this.uppy.log(\n          `[CompanionClient] unable to make preflight request ${err}`,\n          'warning',\n        )\n        // If the user gets a network error or similar, we should try preflight\n        // again next time, or else we might get incorrect behaviour.\n        allowedHeadersCache.delete(this.hostname) // re-fetch next time\n        return fallbackAllowedHeaders\n      }\n    })()\n\n    allowedHeadersCache.set(this.hostname, promise)\n    return promise\n  }\n\n  async preflightAndHeaders (path) {\n    const [allowedHeaders, headers] = await Promise.all([\n      this.preflight(path),\n      this.headers(),\n    ])\n    // filter to keep only allowed Headers\n    return Object.fromEntries(\n      Object.entries(headers).filter(([header]) => {\n        if (!allowedHeaders.includes(header.toLowerCase())) {\n          this.uppy.log(\n            `[CompanionClient] excluding disallowed header ${header}`,\n          )\n          return false\n        }\n        return true\n      }),\n    )\n  }\n\n  /** @protected */\n  async request ({ path, method = 'GET', data, skipPostResponse, signal }) {\n    try {\n      const headers = await this.preflightAndHeaders(path)\n      const response = await fetchWithNetworkError(this.#getUrl(path), {\n        method,\n        signal,\n        headers,\n        credentials: this.opts.companionCookiesRule || 'same-origin',\n        body: data ? JSON.stringify(data) : null,\n      })\n      if (!skipPostResponse) this.onReceiveResponse(response)\n\n      return await handleJSONResponse(response)\n    } catch (err) {\n      // pass these through\n      if (err instanceof AuthError || err.name === 'AbortError') throw err\n\n      throw new ErrorWithCause(`Could not ${method} ${this.#getUrl(path)}`, {\n        cause: err,\n      })\n    }\n  }\n\n  async get (path, options = undefined) {\n    // TODO: remove boolean support for options that was added for backward compatibility.\n    // eslint-disable-next-line no-param-reassign\n    if (typeof options === 'boolean') options = { skipPostResponse: options }\n    return this.request({ ...options, path })\n  }\n\n  async post (path, data, options = undefined) {\n    // TODO: remove boolean support for options that was added for backward compatibility.\n    // eslint-disable-next-line no-param-reassign\n    if (typeof options === 'boolean') options = { skipPostResponse: options }\n    return this.request({ ...options, path, method: 'POST', data })\n  }\n\n  async delete (path, data = undefined, options) {\n    // TODO: remove boolean support for options that was added for backward compatibility.\n    // eslint-disable-next-line no-param-reassign\n    if (typeof options === 'boolean') options = { skipPostResponse: options }\n    return this.request({ ...options, path, method: 'DELETE', data })\n  }\n\n  /**\n   * Remote uploading consists of two steps:\n   * 1. #requestSocketToken which starts the download/upload in companion and returns a unique token for the upload.\n   * Then companion will halt the upload until:\n   * 2. #awaitRemoteFileUpload is called, which will open/ensure a websocket connection towards companion, with the\n   * previously generated token provided. It returns a promise that will resolve/reject once the file has finished\n   * uploading or is otherwise done (failed, canceled)\n   * \n   * @param {*} file \n   * @param {*} reqBody \n   * @param {*} options \n   * @returns \n   */\n  async uploadRemoteFile (file, reqBody, options = {}) {\n    try {\n      const { signal, getQueue } = options\n\n      return await pRetry(async () => {\n        // if we already have a serverToken, assume that we are resuming the existing server upload id\n        const existingServerToken = this.uppy.getFile(file.id)?.serverToken;\n        if (existingServerToken != null) {\n          this.uppy.log(`Connecting to exiting websocket ${existingServerToken}`)\n          return this.#awaitRemoteFileUpload({ file, queue: getQueue(), signal })\n        }\n\n        const queueRequestSocketToken = getQueue().wrapPromiseFunction(async (...args) => {\n          try {\n            return await this.#requestSocketToken(...args)\n          } catch (outerErr) {\n            // throwing AbortError will cause p-retry to stop retrying\n            if (outerErr instanceof AuthError) throw new AbortError(outerErr)\n\n            if (outerErr.cause == null) throw outerErr\n            const err = outerErr.cause\n\n            const isRetryableHttpError = () => (\n              [408, 409, 429, 418, 423].includes(err.statusCode)\n              || (err.statusCode >= 500 && err.statusCode <= 599 && ![501, 505].includes(err.statusCode))\n            )\n            if (err instanceof HttpError && !isRetryableHttpError()) throw new AbortError(err);\n  \n            // p-retry will retry most other errors,\n            // but it will not retry TypeError (except network error TypeErrors)\n            throw err\n          }\n        }, { priority: -1 })\n\n        const serverToken = await queueRequestSocketToken({ file, postBody: reqBody, signal }).abortOn(signal)\n\n        if (!this.uppy.getFile(file.id)) return undefined // has file since been removed?\n\n        this.uppy.setFileState(file.id, { serverToken })\n\n        return this.#awaitRemoteFileUpload({\n          file: this.uppy.getFile(file.id), // re-fetching file because it might have changed in the meantime\n          queue: getQueue(),\n          signal\n        })\n      }, { retries: retryCount, signal, onFailedAttempt: (err) => this.uppy.log(`Retrying upload due to: ${err.message}`, 'warning') });\n    } catch (err) {\n      // this is a bit confusing, but note that an error with the `name` prop set to 'AbortError' (from AbortController)\n      // is not the same as `p-retry` `AbortError`\n      if (err.name === 'AbortError') {\n        // The file upload was aborted, it’s not an error\n        return undefined\n      }\n\n      this.uppy.emit('upload-error', file, err)\n      throw err\n    }\n  }\n\n  #requestSocketToken = async ({ file, postBody, signal }) => {\n    if (file.remote.url == null) {\n      throw new Error('Cannot connect to an undefined URL')\n    }\n\n    const res = await this.post(file.remote.url, {\n      ...file.remote.body,\n      ...postBody,\n    }, signal)\n\n    return res.token\n  }\n\n  /**\n   * This method will ensure a websocket for the specified file and returns a promise that resolves\n   * when the file has finished downloading, or rejects if it fails.\n   * It will retry if the websocket gets disconnected\n   * \n   * @param {{ file: UppyFile, queue: RateLimitedQueue, signal: AbortSignal }} file\n   */\n  async #awaitRemoteFileUpload ({ file, queue, signal }) {\n    let removeEventHandlers\n\n    const { capabilities } = this.uppy.getState()\n\n    try {\n      return await new Promise((resolve, reject) => {\n        const token = file.serverToken\n        const host = getSocketHost(file.remote.companionUrl)\n\n        /** @type {WebSocket} */\n        let socket\n        /** @type {AbortController?} */\n        let socketAbortController\n        let activityTimeout\n\n        let { isPaused } = file\n\n        const socketSend = (action, payload) => {\n          if (socket == null || socket.readyState !== socket.OPEN) {\n            this.uppy.log(`Cannot send \"${action}\" to socket ${file.id} because the socket state was ${String(socket?.readyState)}`, 'warning')\n            return\n          }\n\n          socket.send(JSON.stringify({\n            action,\n            payload: payload ?? {},\n          }))    \n        };\n\n        function sendState() {\n          if (!capabilities.resumableUploads) return;\n\n          if (isPaused) socketSend('pause')\n          else socketSend('resume')\n        }\n\n        const createWebsocket = async () => {\n          if (socketAbortController) socketAbortController.abort()\n          socketAbortController = new AbortController()\n\n          const onFatalError = (err) => {\n            // Remove the serverToken so that a new one will be created for the retry.\n            this.uppy.setFileState(file.id, { serverToken: null })\n            socketAbortController?.abort?.()\n            reject(err)\n          }\n  \n          // todo instead implement the ability for users to cancel / retry *currently uploading files* in the UI\n          function resetActivityTimeout() {\n            clearTimeout(activityTimeout)\n            if (isPaused) return\n            activityTimeout = setTimeout(() => onFatalError(new Error('Timeout waiting for message from Companion socket')), socketActivityTimeoutMs)\n          }\n\n          try {\n            await queue.wrapPromiseFunction(async () => {\n              // eslint-disable-next-line promise/param-names\n              const reconnectWebsocket = async () => new Promise((resolveSocket, rejectSocket) => {\n                socket = new WebSocket(`${host}/api/${token}`)\n\n                resetActivityTimeout()\n\n                socket.addEventListener('close', () => {\n                  socket = undefined\n                  rejectSocket(new Error('Socket closed unexpectedly'))\n                })\n\n                socket.addEventListener('error', (error) => {\n                  this.uppy.log(`Companion socket error ${JSON.stringify(error)}, closing socket`, 'warning')\n                  socket.close() // will 'close' event to be emitted\n                })\n\n                socket.addEventListener('open', () => {\n                  sendState()\n                })\n\n                socket.addEventListener('message', (e) => {\n                  resetActivityTimeout()\n\n                  try {\n                    const { action, payload } = JSON.parse(e.data)\n            \n                    switch (action) {\n                      case 'progress': {\n                        emitSocketProgress(this, payload, file)\n                        break;\n                      }\n                      case 'success': {\n                        this.uppy.emit('upload-success', file, { uploadURL: payload.url })\n                        socketAbortController?.abort?.()\n                        resolve()\n                        break;\n                      }\n                      case 'error': {\n                        const { message } = payload.error\n                        throw Object.assign(new Error(message), { cause: payload.error })\n                      }\n                        default:\n                          this.uppy.log(`Companion socket unknown action ${action}`, 'warning')\n                    }\n                  } catch (err) {\n                    onFatalError(err)\n                  }\n                })\n\n                const closeSocket = () => {\n                  this.uppy.log(`Closing socket ${file.id}`, 'info')\n                  clearTimeout(activityTimeout)\n                  if (socket) socket.close()\n                  socket = undefined\n                }\n        \n                socketAbortController.signal.addEventListener('abort', () => {\n                  closeSocket()\n                })\n              })\n\n              await pRetry(reconnectWebsocket, {\n                retries: retryCount,\n                signal: socketAbortController.signal,\n                onFailedAttempt: () => {\n                  if (socketAbortController.signal.aborted) return // don't log in this case\n                  this.uppy.log(`Retrying websocket ${file.id}`, 'info')\n                },\n              });\n            })().abortOn(socketAbortController.signal);\n          } catch (err) {\n            if (socketAbortController.signal.aborted) return\n            onFatalError(err)\n          }\n        }\n\n        const pause = (newPausedState) => {\n          if (!capabilities.resumableUploads) return;\n\n          isPaused = newPausedState\n          if (socket) sendState()\n\n          if (newPausedState) {\n            // Remove this file from the queue so another file can start in its place.\n            socketAbortController?.abort?.() // close socket to free up the request for other uploads\n          } else {\n            // Resuming an upload should be queued, else you could pause and then\n            // resume a queued upload to make it skip the queue.\n            createWebsocket()\n          }\n        }\n\n        const onFileRemove = (targetFile) => {\n          if (!capabilities.individualCancellation) return\n          if (targetFile.id !== file.id) return\n          socketSend('cancel')\n          socketAbortController?.abort?.()\n          this.uppy.log(`upload ${file.id} was removed`, 'info')\n          resolve()\n        }\n\n        const onCancelAll = ({ reason }) => {\n          if (reason === 'user') {\n            socketSend('cancel')\n          }\n          socketAbortController?.abort?.()\n          this.uppy.log(`upload ${file.id} was canceled`, 'info')\n          resolve()\n        };\n\n        const onFilePausedChange = (targetFileId, newPausedState) => {\n          if (targetFileId !== file.id) return\n          pause(newPausedState)\n        }\n\n        const onPauseAll = () => pause(true)\n        const onResumeAll = () => pause(false)\n\n        this.uppy.on('file-removed', onFileRemove)\n        this.uppy.on('cancel-all', onCancelAll)\n        this.uppy.on('upload-pause', onFilePausedChange)\n        this.uppy.on('pause-all', onPauseAll)\n        this.uppy.on('resume-all', onResumeAll)\n\n        removeEventHandlers = () => {\n          this.uppy.off('file-removed', onFileRemove)\n          this.uppy.off('cancel-all', onCancelAll)\n          this.uppy.off('upload-pause', onFilePausedChange)\n          this.uppy.off('pause-all', onPauseAll)\n          this.uppy.off('resume-all', onResumeAll)\n        }\n\n        signal.addEventListener('abort', () => {\n          socketAbortController?.abort();\n        })\n\n        createWebsocket()\n      })\n    } finally {\n      removeEventHandlers?.()\n    }\n  }\n}\n"],"mappings":"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"}