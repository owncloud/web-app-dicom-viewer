{"version":3,"names":["BasePlugin","getDroppedFiles","toArray","packageJson","isFileTransfer","event","_event$dataTransfer$t","_event$dataTransfer$t2","dataTransfer","types","some","type","DropTarget","constructor","uppy","opts","addFiles","files","descriptors","map","file","source","id","name","data","meta","relativePath","err","log","handleDrop","_this$opts$onDrop","_this$opts","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","currentTarget","classList","remove","setPluginState","isDraggingOver","iteratePlugins","plugin","handleRootDrop","executedDropErrorOnce","logDropError","error","info","message","length","onDrop","call","handleDragOver","_this$opts$onDragOver","_this$opts2","dropEffect","add","onDragOver","handleDragLeave","_this$opts$onDragLeav","_this$opts3","setTimeout","onDragLeave","addListeners","target","Element","nodes","document","querySelectorAll","Error","forEach","node","addEventListener","removeListeners","removeEventListener","title","defaultOpts","install","uninstall","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport toArray from '@uppy/utils/lib/toArray'\n\nimport packageJson from '../package.json'\n\nfunction isFileTransfer (event) {\n  return event.dataTransfer.types?.some((type) => type === 'Files') ?? false\n}\n\n/**\n * Drop Target plugin\n *\n */\nexport default class DropTarget extends BasePlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DropTarget'\n    this.title = 'Drop Target'\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n    this.removeDragOverClassTimeout = null\n  }\n\n  addFiles = (files) => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  handleDrop = async (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    event.currentTarget.classList.remove('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: false })\n\n    // Let any acquirer plugin (Url/Webcam/etc.) handle drops to the root\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin.type === 'acquirer') {\n        // Every Plugin with .type acquirer can define handleRootDrop(event)\n        plugin.handleRootDrop?.(event)\n      }\n    })\n\n    // Add all dropped files, handle errors\n    let executedDropErrorOnce = false\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n\n      // In practice all drop errors are most likely the same,\n      // so let's just show one to avoid overwhelming the user\n      if (!executedDropErrorOnce) {\n        this.uppy.info(error.message, 'error')\n        executedDropErrorOnce = true\n      }\n    }\n\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DropTarget] Files were dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  handleDragOver = (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser,\n    // https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy' // eslint-disable-line no-param-reassign\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    event.currentTarget.classList.add('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: true })\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave = (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    const { currentTarget } = event\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      currentTarget.classList.remove('uppy-is-drag-over')\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n    this.opts.onDragLeave?.(event)\n  }\n\n  addListeners = () => {\n    const { target } = this.opts\n\n    if (target instanceof Element) {\n      this.nodes = [target]\n    } else if (typeof target === 'string') {\n      this.nodes = toArray(document.querySelectorAll(target))\n    }\n\n    if (!this.nodes && !this.nodes.length > 0) {\n      throw new Error(`\"${target}\" does not match any HTML elements`)\n    }\n\n    this.nodes.forEach((node) => {\n      node.addEventListener('dragover', this.handleDragOver, false)\n      node.addEventListener('dragleave', this.handleDragLeave, false)\n      node.addEventListener('drop', this.handleDrop, false)\n    })\n  }\n\n  removeListeners = () => {\n    if (this.nodes) {\n      this.nodes.forEach((node) => {\n        node.removeEventListener('dragover', this.handleDragOver, false)\n        node.removeEventListener('dragleave', this.handleDragLeave, false)\n        node.removeEventListener('drop', this.handleDrop, false)\n      })\n    }\n  }\n\n  install () {\n    this.setPluginState({ isDraggingOver: false })\n    this.addListeners()\n  }\n\n  uninstall () {\n    this.removeListeners()\n  }\n}\n"],"mappings":"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"}