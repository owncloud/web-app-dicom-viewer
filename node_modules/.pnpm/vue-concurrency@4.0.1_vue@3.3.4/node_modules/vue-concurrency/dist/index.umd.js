!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("vue"),require("caf")):"function"==typeof define&&define.amd?define(["exports","vue","caf"],n):n((e||self).vueConcurrency={},e.vue,e.caf)}(this,function(e,n,t){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/r(t);function i(){i=function(){return e};var e={},n=Object.prototype,t=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",c=r.asyncIterator||"@@asyncIterator",u=r.toStringTag||"@@toStringTag";function a(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{a({},"")}catch(e){a=function(e,n,t){return e[n]=t}}function s(e,n,t,r){var o=Object.create((n&&n.prototype instanceof p?n:p).prototype),i=new L(r||[]);return o._invoke=function(e,n,t){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(t.method=o,t.arg=i;;){var c=t.delegate;if(c){var u=b(c,t);if(u){if(u===l)continue;return u}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===r)throw r="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);r="executing";var a=f(e,n,t);if("normal"===a.type){if(r=t.done?"completed":"suspendedYield",a.arg===l)continue;return{value:a.arg,done:t.done}}"throw"===a.type&&(r="completed",t.method="throw",t.arg=a.arg)}}}(e,t,i),o}function f(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l={};function p(){}function d(){}function h(){}var v={};a(v,o,function(){return this});var y=Object.getPrototypeOf,g=y&&y(y(O([])));g&&g!==n&&t.call(g,o)&&(v=g);var m=h.prototype=p.prototype=Object.create(v);function _(e){["next","throw","return"].forEach(function(n){a(e,n,function(e){return this._invoke(n,e)})})}function w(e,n){function r(o,i,c,u){var a=f(e[o],e,i);if("throw"!==a.type){var s=a.arg,l=s.value;return l&&"object"==typeof l&&t.call(l,"__await")?n.resolve(l.__await).then(function(e){r("next",e,c,u)},function(e){r("throw",e,c,u)}):n.resolve(l).then(function(e){s.value=e,c(s)},function(e){return r("throw",e,c,u)})}u(a.arg)}var o;this._invoke=function(e,t){function i(){return new n(function(n,o){r(e,t,n,o)})}return o=o?o.then(i,i):i()}}function b(e,n){var t=e.iterator[n.method];if(void 0===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=void 0,b(e,n),"throw"===n.method))return l;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=f(t,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,l;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,l):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,l)}function E(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function x(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function O(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(t.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return d.prototype=h,a(m,"constructor",h),a(h,"constructor",d),d.displayName=a(h,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===d||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,a(e,u,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},_(w.prototype),a(w.prototype,c,function(){return this}),e.AsyncIterator=w,e.async=function(n,t,r,o,i){void 0===i&&(i=Promise);var c=new w(s(n,t,r,o),i);return e.isGeneratorFunction(t)?c:c.next().then(function(e){return e.done?e.value:c.next()})},_(m),a(m,u,"Generator"),a(m,o,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),e.keys=function(e){var n=[];for(var t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=O,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&t.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t,r){return c.type="throw",c.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=t.call(i,"catchLoc"),a=t.call(i,"finallyLoc");if(u&&a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&t.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var c=i?i.completion:{};return c.type=e,c.arg=n,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(c)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),l},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),x(t),l}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var r=t.completion;if("throw"===r.type){var o=r.arg;x(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,t){return this.delegate={iterator:O(e),resultName:n,nextLoc:t},"next"===this.method&&(this.arg=void 0),l}},e}function c(){return c=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},c.apply(this,arguments)}function u(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function a(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return u(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?u(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=function(e){return e._runningInstances.length>=e._maxConcurrency},f=function(e){var n=e._activeInstances[0];n&&n.cancel()},l=function(e){e._enqueuedInstances.forEach(function(e){e.isEnqueued=!1,e.isDropped=!0})};function p(e,t){return t?function(e,t,r){return n.computed(function(){return e().filter(function(e){return e[t]})})}(function(){return e()._instances},t):n.computed(function(){return[]})}function d(e){return n.computed(function(){return e().length})}function h(e){return n.computed(function(){var n=e();return n[n.length-1]})}function v(e){return n.computed(function(){return e()[0]})}function y(e){return n.reactive(e)}function g(e,r,i){var c,u,a={id:i.id,isDropped:!1,isEnqueued:!1,hasStarted:!1,isRunning:!1,isFinished:!1,isCanceling:!1,isCanceled:n.computed(function(){return s.isCanceling&&s.isFinished}),isActive:n.computed(function(){return s.isRunning&&!s.isCanceling}),isSuccessful:!1,isNotDropped:n.computed(function(){return!s.isDropped}),isError:n.computed(function(){return!!s.error}),status:n.computed(function(){var e=[[s.isRunning,"running"],[s.isEnqueued,"enqueued"],[s.isCanceled,"canceled"],[s.isCanceling,"canceling"],[s.isDropped,"dropped"],[s.isError,"error"],[s.isSuccessful,"success"]].find(function(e){return e[0]});return e&&e[1]}),error:null,value:null,cancel:function(e){if((void 0===e?{force:!1}:e).force||(s.isCanceling=!0,s.isEnqueued&&(s.isFinished=!0),s.isEnqueued=!1),s.token&&s._canAbort){s.token.abort("cancel");try{s.token.discard()}catch(e){}s.token=void 0,s._canAbort=!1}},canceledOn:function(e){return e.pr.catch(function(e){s.cancel()}),s},_run:function(){!function(e,n,r,i){var c=new t.cancelToken,u=o.default(n,c);function a(){e.isRunning=!1,e.isFinished=!0}e.token=c,e.hasStarted=!0,e.isRunning=!0,e.isEnqueued=!1,u.call.apply(u,[e,c].concat(r)).then(function(n){e.value=n,e.isSuccessful=!0,a(),e._deferredObject.resolve(n),e._canAbort=!1,i.onFinish(e)}).catch(function(n){"cancel"!==n&&(e.error=n),a(),e._shouldThrow&&e._deferredObject.reject(n),i.onFinish(e)})}(s,e,r,i)},_handled:!0,_deferredObject:(c={},u=new Promise(function(e,n){c.resolve=e,c.reject=n}),c.promise=u,c),_shouldThrow:!1,_canAbort:!0,then:function(e,n){return s._shouldThrow=!0,s._deferredObject.promise.then(e,n)},catch:function(e,n){return void 0===n&&(n=!0),s._shouldThrow=n,s._deferredObject.promise.catch(e)},finally:function(e){return s._shouldThrow=!0,s._deferredObject.promise.finally(e)}},s=y(a),f=i.modifiers;return f.drop?s.isDropped=!0:f.enqueue?s.isEnqueued=!0:s._run(),s}function m(e,t){void 0===t&&(t={cancelOnUnmount:!0});var r=n.getCurrentInstance(),o=n.effectScope(),i={_isRestartable:!1,_isDropping:!1,_isEnqueuing:!1,_isKeepingLatest:!1,_maxConcurrency:1,_hasConcurrency:n.computed(function(){return c._isRestartable||c._isDropping||c._isEnqueuing||c._isKeepingLatest}),isIdle:n.computed(function(){return!c.isRunning}),isRunning:n.computed(function(){return!!c._instances.find(function(e){return e.isRunning})}),isError:n.computed(function(){return!(!c.last||!c.last.isError)}),_instances:[],_successfulInstances:p(function(){return c},"isSuccessful"),_runningInstances:p(function(){return c},"isRunning"),_enqueuedInstances:p(function(){return c},"isEnqueued"),_notDroppedInstances:p(function(){return c},"isNotDropped"),_activeInstances:p(function(){return c},"isActive"),performCount:d(function(){return c._instances}),last:h(function(){return c._notDroppedInstances}),lastSuccessful:h(function(){return c._successfulInstances}),firstEnqueued:v(function(){return c._enqueuedInstances}),cancelAll:function(e){var n=(void 0===e?{force:!1}:e).force;c._instances.forEach(function(e){try{(n||!e.isDropped&&!e.isFinished)&&e.cancel({force:n})}catch(e){if("cancel"!==e)throw e}})},perform:function(){var n=arguments,t={enqueue:!1,drop:!1};c._hasConcurrency&&s(c)&&(c._isDropping&&(t.drop=!0),c._isRestartable&&f(c),c._isKeepingLatest&&l(c),(c._isEnqueuing||c._isKeepingLatest)&&(t.enqueue=!0));var r=function(){return _(c)},i=function(){return g(e,[].slice.call(n),{modifiers:t,onFinish:r,scope:o,id:c._instances.length+1})},u=o.active?o.run(i):i();return o.active||console.warn("Task instance has been created in inactive scope. Perhaps youre creating task out of setup?"),c._instances=[].concat(c._instances,[u]),u},clear:function(){this.cancelAll({force:!0}),this._instances=[]},destroy:function(){o.stop(),this.clear()},restartable:function(){return c._resetModifierFlags(),c._isRestartable=!0,c},drop:function(){return c._resetModifierFlags(),c._isDropping=!0,c},enqueue:function(){return c._resetModifierFlags(),c._isEnqueuing=!0,c},keepLatest:function(){return c._resetModifierFlags(),c._isKeepingLatest=!0,c},_resetModifierFlags:function(){c._isKeepingLatest=!1,c._isRestartable=!1,c._isEnqueuing=!1,c._isDropping=!1},maxConcurrency:function(e){return c._maxConcurrency=e,c}},c=y(i);return r&&t.cancelOnUnmount&&n.onBeforeUnmount(function(){c._instances&&c.destroy()}),c}function _(e){if(e._isEnqueuing||e._isKeepingLatest){var n=e.firstEnqueued;n&&n._run()}}var w=function(){return"undefined"==typeof window};function b(e){e._deferredObject.promise=e.isError?Promise.reject(e.error):Promise.resolve(e.value),e.cancel=function(){},e.canceledOn=function(){return e},e._run=function(){},e.then=function(){var n;return(n=e._deferredObject.promise).then.apply(n,[].slice.call(arguments))},e.catch=function(){var n;return(n=e._deferredObject.promise).catch.apply(n,[].slice.call(arguments))},e.finally=function(){var n;return(n=e._deferredObject.promise).finally.apply(n,[].slice.call(arguments))}}function E(e,t){var r=n.getCurrentInstance().$root,o=r&&r.context&&r.context.nuxtState;if(!o)throw new Error("Could not access $root.context.nuxtState");o.vueConcurrency||(o.vueConcurrency={}),o.vueConcurrency[e]=n.computed(function(){return{instances:t._instances}})}function x(e,n){var t=function(e){if(!L())throw Error("Could not access  window.__NUXT__");return L().vueConcurrency[e].value}(e);return t&&(n._instances=t.instances||[],n._instances.forEach(b),function(e){delete L().vueConcurrency[e]}(e)),n._instances}function L(){return window.__NUXT__}e.getCancelToken=function(e,n){return new e.CancelToken(function(e){n.pr.catch(function(n){"cancel"===n&&e()})})},e.printTask=function(e){var n="General";e._isDropping&&(n="Drop"),e._isEnqueuing&&(n="Enqueue"),e._isRestartable&&(n="Restartable"),e._isKeepingLatest&&(n="KeepLatest");var t=n+" Task";"General"!==n&&(t=t+" with maxConcurrency "+e._maxConcurrency);var r=e._instances.map(function(e){var n;return e.isSuccessful?n="🍏":e.isRunning||e.isEnqueued?n="🍊":(e.isError||e.isCanceled||e.isDropped)&&(n="🔴"),{status:n+" "+e.status,value:e.value,error:e.error}});console.log("🚦 "+t),console.table(r)},e.timeout=function(e){return"test"===process.env.NODE_ENV?Promise.resolve():new Promise(function(n){return setTimeout(n,e)})},e.useAsyncTask=function(e){return m(/*#__PURE__*/i().mark(function n(t){var r=arguments;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e.apply(void 0,[t].concat([].slice.call(r,1))));case 1:case"end":return n.stop()}},n)}))},e.useParallelTask=function(){var e=[].slice.call(arguments);return m(/*#__PURE__*/i().mark(function n(t){var r,o=arguments;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.map(function(e){return e.perform.apply(e,[].slice.call(o,1)).canceledOn(t)}),n.next=3,Promise.all(r);case 3:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n)}))},e.usePipeTask=function(e){var n=[].slice.call(arguments,1);return m(/*#__PURE__*/i().mark(function t(r){var o,c,u,s,f=arguments;return i().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.perform.apply(e,[].slice.call(f,1)).canceledOn(r);case 2:o=t.sent,c=a(n);case 4:if((u=c()).done){t.next=11;break}return s=u.value,t.next=8,s.perform(o).canceledOn(r);case 8:o=t.sent;case 9:t.next=4;break;case 11:return t.abrupt("return",o);case 12:case"end":return t.stop()}},t)}))},e.useSSRPersistance=function(e,n){w()?E(e,n):x(e,n)},e.useSequentialTask=function(){var e=[].slice.call(arguments);return m(/*#__PURE__*/i().mark(function n(t){var r,o,c,u,s=arguments;return i().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=[],o=a(e);case 2:if((c=o()).done){n.next=11;break}return u=c.value,n.t0=r,n.next=7,u.perform.apply(u,[].slice.call(s,1)).canceledOn(t);case 7:n.t1=n.sent,n.t0.push.call(n.t0,n.t1);case 9:n.next=2;break;case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}},n)}))},e.useTask=m,e.useTaskGroup=function(e){var t=Object.values(e),r=n.reactive(c({isRunning:n.computed(function(){return!!t.find(function(e){return e.isRunning})}),isIdle:n.computed(function(){return!r.isRunning}),isError:n.computed(function(){return!!t.find(function(e){return e.isError})})},e));return r},e.useTaskPrefetch=function(e,t){if(w()){var r=t.perform();return n.onServerPrefetch(function(){try{var n=function(n,o){try{var i=Promise.resolve(r).then(function(){E(e,t)})}catch(e){return}return i&&i.then?i.then(void 0,function(){}):i}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}),r}return x(e,t).reverse()[0]||t.perform()},e.waitForValue=function(e){return new Promise(function(t){var r=n.watch(e,function(e){null!=e&&(t(e),r&&r())},{immediate:!0})})}});
//# sourceMappingURL=index.umd.js.map
